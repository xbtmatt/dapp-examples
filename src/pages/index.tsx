import Image from 'next/image'
import styles from '../app/index.module.css'
import WalletModal from '@/wallet/WalletModal'
import { useState } from 'react'
import { NextPage } from 'next'
import ConnectButton from '@/components/buttons/ConnectButton'
import { useWallet } from '@aptos-labs/wallet-adapter-react'
import { ScriptFunctionPayload } from '@/modules/types'
import { HexString, BCS, TxnBuilderTypes } from 'aptos'
import OnRender from '@/components/utils/OnRender'

const IndexPage: NextPage = () => {
    const [walletModalOpen, setWalletModalOpen] = useState<boolean>(false);
    const {
        connected,
        connect,
        disconnect,
        wallet,
        wallets,
        network,
        signAndSubmitTransaction,
        signAndSubmitBCSTransaction
    } = useWallet();

    const handleCloseWalletModal = () => { }
    const handleCloseMintModal = () => { }

    const publishPayload = async () => {
        const metadataSerialized = new HexString("0x0c546f6b656e204c6f636b75700100000000000000004041393033453831364445353832363134443031334639363043383144433345313546374335383538384130304330344231414641463838414132433930434536a7011f8b08000000000002ff8d8eb10ec220144577be82b03095d60f7070713271716b9a06e1692a9547007530febbbc563b3779cbcb3d39f7b6411ba7afd031afefc0b75c9ed081e70734ee11247b424c037a0a36aa518d64acd5d646480952c732c13d9e6f60722a90e845012c04f016bc1988d9858c691f8bfe85d115e8cd47347a245ca97abecb3faf35e1d5f20bfe990dd3aee3d2b44632adab7eeb48f405cfab19d4ee000000020a756e69745f7465737473ca091f8b08000000000002ffed586d6fdb3610fe9e5f716b8042de34c492d3b45096615d9701c536b468bc4f45c13216656b914583a4ea7845fefb8ea428c9b6e497d4413bb4fad0862ff7c2bbe7391e3de571913150fc86e5845fffc3464a465191a78a282695848f470070fc560f08cfb3c53b3d2e2403a9e22892e93867e2bc6b0f9d292e4922e894cdb9b889226b61f7fd7434e245be87804aa7b8894e679d222b47b5c38c8f6e8a6e197b5625d27c1c451faf5896dc6d71a9cd0a8a0ef5ff28ab378f782e150c2faf86e46af8fccd900c5ffe75194171760a1710f4dd670c9d9c40780a135e0809690e3c6710d3057c0f677d98a679816eb879bdc92e488626e26ac1eec3a5a75a56d62efcf9eac51f7fbf26af2fdfbc7cf51bb9ba7c71e5bcf0d0a851a5ffe96951ebfaeab99322476baa9819d0787a4a7f23c1a8e22282c71627be5be0731c91a06b215c5f584df4da064cba40cc62fa8df366be67d16bbf0a1998496677920995c408b298245c18ef31c7de8ab5de79ab9a621653c5c838e3d734b30a9d1282b1975eed53534389e92832e161a41c57b29e3d19823f8e059392f0c42b23d9fb543d65e00fa4275cd2d3645214a55842529aa5ff3232e259863448795e9dc388dd756229a1d2d89f531197a1b45836b9add3ba4f321a7b733e27a542af073f38a2ac7b05ce61e4c22ffddbdf9ffb0eba76a21a8776fcabbf0a543b1ff4de59169fc0d0545525682e13267445816991a974e6aa302e7288d3045759aeac7e09f3544d4066e978a2b24563b90c33d8b0db80b8289ab34fe86cb62033aa268e965dacec226517273752b2ce514b5da87cf0eb99d2fada4cd89859b1d85859a9a2e542cf562bfc32a69c05a2618c69d9c08ef335a970ab54581bc32c63ad5510d884ea7c323a9a004f404d188456a7e39d6c18b3140a88a9cba2186188886009da5d2697568f578c43a70fee6e2a54f2ccbb7e64ae19380e1ef5fca5632f9dccaa0c0f652cac8d85cbc6ea784cb96075501c95f4e56429081972589462eb452068f17f7028ff072dc16a490d5ee968c15eecae9f4148f2e9aa1fdee38e6cb626616fb5e10e6a07fbab1db4a8add3a85302654ac0965a5372e07a81d99d3376033fe21f36999d69f4d61b8e9e965b328585b040862163a832b4799f6945ae70bed76e585a593ca512bb1921f07cae3c49c984face5b06c38794cdc99226af91d91e5c5cacd6121ffa5568f7d41976eb0ceeab73d0a513efb1c0075386ea283a6113c12415b28406680c5404acb8181eb55de59507ae4637c9d0cdf925db25bfd78c878d42b08bf1d06f52a6a3ba6d45ea1680069dc7509354c4070ce1607308bf181220b8da58ebc3e0e0dce83475fa109469ad4586494f3697a3b22fc3b999ee6d3f306ccba86055d75235344011f7cbd870febbba9c621fa13778ddbcf2e16cedf81de26dccf0e1e9aee28356ebcf1ebc393e7ecb6e7528f5538ca61946dba3d71cdf4f231e33dcd9bf7d82afe181af5b5daa1f1338d7f1fb42af7a4838241041e746edd7de043f4487b9cb3bd381ad99106fe3c14b01a774bf16aba16843c75e47e84b80767f09da1b7ea66a81b7e29c302ab2c5377c7f1e7c1ffc89505f3d8de711a6194c9aefd35bdfa3b5dbfacbcf67274df009a4990b9e8fcbbbef1b6dfe3fb4f9c958f97907f6acf3a3851ee77bbd3bb63123a8987177f41f92ce2c0e5d19000000000c746f6b656e5f6c6f636b75708f0a1f8b08000000000002ff9d576d6fdb3610fede5fc1b64020156e9d0d4557286980c03506a3891dd80eb6a12858593adb9c25d223a9785e90ffbea348bd5a4ed2fa436292c7e7ee9e3b3ea453116709102d36c0a958fc0d9156416087898836d996dcbf2084640a88d2711028b6e220cf1a7362ab99e0cd399052b4cc94968caf82e07e06c9b24766f9f0a105958750da4cf2618fcc65c8d512e414707220384265911666dc02d02c05a5c3745b4e875b2d146d6528c53e4cf41e1d4dedb787c7edf36119d6dc8c9ed8118924c16f3931c6f0f557094a643202ba9222dbd214d205482f1f904f0e6429c31476426e2a2a2c07bf1b33ff9b41b2c993abbc3c48c692adc83a5464037b5b2cfc24a1d2543bd602927d78df732bc52495b00c1ac41a83873cd67ebf4fe66b206287b5266249f4daf548ee880b9d2fc58469b214922482af087091add6667b640a4486f3c997e1988ec6f46a32f8727b934781899e9e1dba48339543d61c6951868a6e6ab0e3c99c5ae8c91fe3e1b480fdc5d26c8d0693ababe1603e9a8ce9f8f27a18903b30ed729e7dbc40d3c5ab298b36a0f7641a4691c01dafce3af77e1ece06d3d18df97e007149aa0a1b8aa483940ef2e511ccdbe9e8006badf55605fdbec3400883b08385621ade4522ed57be0aa3b7ced1bb2d5fd55d596a7ece4bcebcea1f41bebefc73747d7b4d67b73737577f95bc9f9e161525bfbe276b6c71451852c281c4e19ebc211f4e49ca78a6a19c374676410162c7e582b5c3a5dfcc5e55f9b62d446f86d3d1e4339d0d07b3c2bf874e7328f3c7375b6d236cb345c222b2cc388233cdc284fd07b4e2d18b2484484f404eaca6f9e5e1a98cf0181b2ba04bf62fc4f5ddced4585b9c5e3553085da6971fbdee76f26be64d5e9f81635aba0e60f53708385278eef4ecc2f39f81846d529af9679500d4c8c392a0928822e1366ba5ace4eac751bd02a7ecd54a40c23846f553f9941fb414bc122dd00e27aa0c8c4e61999d00bb72183fb155dc9faa449bc11fac5895ec912a1c27bf3c9e75deebf9d7e419d32e2e811520d726f3faba77d2c9962d64834f5bab2e3cbbf27c240b5043b2fff1e212697bfb797e4f5e1c0777e8a81ca5d4372f001c488880dd2181c4a852c6355900de39407640b620d39003d7c99ec44c850b7cca647c8579c525a2f351845b4c17c7bfd7c8cb8c1a7115a8269270c112860a5fbf996ae1aea5b9ff48c8f724055c2602178d4568afb5efc5a6efe65cd97b03738861c938b4a2746ea94ba6ac3a5259ab7f15692aeea07648f173522f7cad191baf86fb6afef0cd50bea44c4befa853ea4667b79e13b5958783e6eeec8103c5c15aca7dae3b65ca6ebf69b06ed509dc33d1b5db51ddc106fa276338ee2601ab2d21ce781c628fe5cf5712ad21da98d6338f9c288150ba05644685aba26aa15220f54bafa81e53347fd67879783d62630e02170d154bcf64e3fb3d0b1704a6919952d8123406ce20f6dacf1cbf7116b12046138f54a86e691ff18677932b3e03047adcd15522166142d34c9fd7c9b8f05ac7da85ec8eb0dfd22af48f1dc6a34a96d08389ed6dd3efbb466b758487f933119b0c14221c5ef6672da6bb3c5f7cea407b8ce1d6fbd46f1cfc42204982a713eb5eba31ba1cf2b84b022c67f5ecf2bdf4294def30f34e9a04b68e7db7a6d11dd3eb7c7707e281b465dbd8e467c277bff45c93a0bea1bd79e8d845b452ba962f72ef50de9c60033d566adb0eb587c5ebaf770c76df5a6f0c33471b1bbda70eb86fdf7f8f1fe946b3ff58a337f3b0093cbcf81fa5218ca82f0f000000000400000000000000000000000000000000000000000000000000000000000000010e4170746f734672616d65776f726b00000000000000000000000000000000000000000000000000000000000000010b4170746f735374646c696200000000000000000000000000000000000000000000000000000000000000010a4d6f76655374646c69620000000000000000000000000000000000000000000000000000000000000004114170746f73546f6b656e4f626a6563747300").toUint8Array();

        const bytes = BCS.serializeVectorWithFunc([
                new HexString('0xa11ceb0b060000000401000207020b080d20062d1400000a756e69745f7465737473b7c22590e1532069403c2a721bcf31d1a45fc3acd7c12903b3cf0fe23f4864110308803a090000000000030800ca9a3b0000000000').toUint8Array(),
                new HexString('0xa11ceb0b060000000c010014021428033c6904a5010a05af01940107c302840408c7066006a707dd01108409ed010af10a080cf90ac1010dba0c040000010101020103010401050106020702080209000a0800020c0200050d0700020f07010001091008000215060008170b0003180701000002250200000b000100000e0203000011040100001205060005160708000319010a0100071a0b0300091b0d0300021c0e0f00021d0e1000021e0e120108021113010108021f1401000620010600042100160002221718010801230606000224191601080226141a0002271b010005090a110b110f11111101060c0003060c08020501080103060c0b0301080405010b030108040103010a02010802010806010b0701090006060c08020308020b0701080608020408010b030108040c080506060c0802080208020b07010806080201060801010805010c010804010b0301090003060c0b03010900050106080502070800030105020b0301090005010101060b03010900010808020808050c746f6b656e5f6c6f636b7570056572726f72066f626a656374066f7074696f6e067369676e657206737472696e670974696d657374616d700a636f6c6c656374696f6e07726f79616c747905746f6b656e0c4c6f636b7570436f6e66696715696e697469616c697a655f636f6c6c656374696f6e0e436f6e7374727563746f7252656606537472696e67076d696e745f746f064f626a65637405546f6b656e087472616e7366657212766965775f6c6173745f7472616e736665720d6c6173745f7472616e736665720c7472616e736665725f7265660b5472616e73666572526566047574663807526f79616c7479064f7074696f6e046e6f6e65176372656174655f66697865645f636f6c6c656374696f6e126372656174655f6e616d65645f746f6b656e1567656e65726174655f7472616e736665725f7265660f67656e65726174655f7369676e65721b6f626a6563745f66726f6d5f636f6e7374727563746f725f7265661864697361626c655f756e67617465645f7472616e736665720b6e6f775f7365636f6e64730a616464726573735f6f660869735f6f776e6572117065726d697373696f6e5f64656e6965640e6f626a6563745f61646472657373114c696e6561725472616e736665725265661c67656e65726174655f6c696e6561725f7472616e736665725f726566117472616e736665725f776974685f726566b7c22590e1532069403c2a721bcf31d1a45fc3acd7c12903b3cf0fe23f486411000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000040a0222214120636f6c6c656374696f6e206f66207269636b65747920726163636f6f6e73210a0211105269636b65747920526163636f6f6e730a02414068747470733a2f2f7269636b6574797261636f6f6e73776562736974652e636f6d2f636f6c6c656374696f6e2f7269636b6574792d726163636f6f6e2e706e6703080100000000000000030800000000000000000308803a0900000000000308e8030000000000000a02353468747470733a2f2f7269636b6574797261636f6f6e73776562736974652e636f6d2f746f6b656e732f726163636f6f6e2e706e67126170746f733a3a6d657461646174615f7631d8010200000000000000001045544f4b454e5f494e5f4c4f434b555037546865206f776e6572206f662074686520746f6b656e20686173206e6f74206f776e656420697420666f72206c6f6e6720656e6f756768010000000000000010454e4f545f544f4b454e5f4f574e45522b546865206f776e6572206d757374206f776e2074686520746f6b656e20746f207472616e73666572206974010c4c6f636b7570436f6e666967010301183078313a3a6f626a6563743a3a4f626a65637447726f75700112766965775f6c6173745f7472616e73666572010100000202130314080500010000010c0b000700110407060701110438000702110411060102010100000c210a0007011104070011040b0138000707110411070c030e0311080c060e0311090c050e0338010c040b000b040b0238020e06110c0e05110d0b0612002d000b0302020104010015270a010b00110e3803040605090703111027110d0c040e0138042a000c030a040a03100014170705260418051d0b030107041110270a03100111120b0211130b040b030f001502030100010001060e0038042b00100014020000000100').toUint8Array()
            ],
            "serializeBytes",
        );

        const payloadIncorrect: TxnBuilderTypes.TransactionPayload = {
            type: "entry_function_payload",
            function: `0x1::code::publish_package_txn`,
            type_arguments: [],
            arguments: [
                BCS.bcsSerializeBytes(metadataSerialized),
                bytes,
            ],
        };

        const payload = new TxnBuilderTypes.TransactionPayloadEntryFunction(
            TxnBuilderTypes.EntryFunction.natural(
                "0x1::code",
                "publish_package_txn",
                [],
                [
                    BCS.bcsSerializeBytes(metadataSerialized),
                    bytes,
                ],
            )
        );

        await signAndSubmitBCSTransaction(payload);
    }

    return (
        <OnRender>
            <ConnectButton
                buttonText={ !connected ? 'Connect' : 'Publish Package' }
                handleClick={publishPayload}
            >
            </ConnectButton>
            <WalletModal
                isOpen={walletModalOpen}
                handleClose={handleCloseWalletModal}
                onAfterOpen={() => { }}
                onRequestClose={handleCloseMintModal}
            />
        </OnRender>
    )
}


export default IndexPage;